# dirSync

Мелкая тулза для синка нескольких директорий друг с другом. Юзать так:
python3 sync.py -dirs dirA dirB [...etc...] -i  [интервал синхронизации в секундах]

При запуске она синхронизирует все указанные папки путём копирования в них недостающих объектов.
Для одинаковых сравнивает дату последней модификации и заменяет все во всех директориях на самый новый.
После первой синхронизации начинает также отслеживать удаления элементов.

Репарспоинты никак отдельно не обрабатываются и, скорее всего, будут работать некорректно. Защиты от циклических репарспоинтов нет.

Алгоритм:
1. sh.enumItems - заэнумерили во всех директориях элементы
2. sh.compareItems - сравнили их
3. sh.getItemsToSync - найденные различия поместили в очередь на синхронизацию
4. sh.delRemovedItems - удалили из энумерации уже не существующие элементы
5. повторили через интервал

В хелпере два класса:
1. Item - на каждый элемент (директория, файл) создаётся экземпляр. Содержит в себе инфу об айтеме и список директорий [Dir] в которых айтем должен быть
  Содержит относительный путь элемента (по нему и происходит синхронизация), флаги: является ли элемент синхронизированным, помечен ли он на удаление, помечен ли он на создание, модифицирован ли он, является ли он файлом.
  Поддерживает несколько методов:
    addDirectory - Добавить директорию для синхронизации
    removeDirectory - Удалить директорию для синхронизации (не используется)
    markForDelete - Пометить элемент на удаление (если он был удалён в одной из трекающихся директорий, то помечается на удаление, чтобы алгоритм вынес его во всех директориях)
    markForCreate - Пометить элемент на создание (если в одной из директорий был создан новый элемент, то алгоритм создаст его во всех)
    foundLatestVersion - Найти последнюю версию (чтобы засинкать его в остальных директориях)
    updateDirs - вызвать для каждой директории элемента метод update
    printDirsStatus - вывести на экран информацию о директориях для элемента
    update - обновить информацию о элементе
      метод выполняется только для синхронизированных файлов (так как несинхронизированные ещё в неконсистентном стейте)
      1. Сперва мы обновляем инфу обо всех директориях для элемента
      2. Затем проверяем, не нужно ли нам элемент удалить
      3. Затем проверяем, не нужно ли нам элемент создать
      4. Если обе проверки (3,4) вернули false, то проверяем, не модифицирован ли элемент и не нужно ли нам его обновить в других местах.
        4.1. Для этого находим латест версию
        4.2. Затем выставляем направления синхронизации: 1 для латест версии, -1 для всех остальных.

2. Dir - создаётся для каждого айтема с инфой о конкретной директории. Именно по экземплярам этого класса происходит сравнение состояния айтема во всех директориях.
  Есть важный атрибут - direction:
    0 - файл синхронизирован
    1 - этот файл является сурсным при синхронизации (он был изменён последним/создан)
    -1 - этот файл является таргетом при синхронизации
    2 - этот файл должен быть удалён
    3 - этот файл не существует (а значит должен быть скопирован из другой локации)

   Класс dir поддерживает 2 метода:
    update - получение информации о дате модификации и выставления атрибута direction в 2 или 3 (если файл был удалён или не существовал)
    setDirection - выставление атрибута direction

В отдельном потоке крутится функция синхронизации syncItemsAsync:
  Она проверяет не появилось ли в очереди на синхронизацию чего нового. Если появилось, то для каждого элемента из очереди вызывает функцию синхронизации syncItem. После синхронизации выставляет флаг isSync в значение True

Функция getItemsToSync помещает ожидающие синхронизации элементы в очередь на синхронизацию
Функция delRemovedItems удаляет из списка элементы, которые уже не существуют на ФС и их удаление было синхронизировано
